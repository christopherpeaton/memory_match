<!DOCTYPE html>
<html ng-app="myApp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <link rel='stylesheet’ href=’https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css'>
    <script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js'></script>
    <!--<script src="main.js"></script>-->

</head>
<body ng-controller="programController as pc">
<!-- Header ------------------------------------------------------------------ -->
<div id="header">
    <div id="logo">
        <img src="photos/944503_354720097988347_450575865_n .jpg" alt="logo">
    </div>
    <ul class=list-group" id="menu">
        <li class=list-group-item" id="title">Match Game</li>
        <!--<li class=list-group-item"><a href="#settings">Settings</a></li>-->
        <li class=list-group-item"><a href="about.html">About</a></li>
    </ul>

</div>
<!-- Info/Left Nav ------------------------------------------------------- -->
<div class="info">
    <div class="tower">
        <img src="photos/michelin_seven.png" alt="michelin tower">
    </div>
    <ul class="list-group stats">
        <li>
            <ul class="list-group" id="games_played">
                <li class="list-group-item">Games Played</li>
                <li class="list-group-item played_value">{{ pc.games_played }}</li>
            </ul>
            <ul class="list-group" id="attempts">
                <li class="list-group-item">Attempts</li>
                <li class="list-group-items attempts_value">{{ pc.getGameStat('attempts') }}</li>
            </ul>
            <ul class="list-group" id="matches">
                <li class="list-group-item">Matches</li>
                <li class="list-group-item matches_value">{{ pc.getGameStat("matches") }}</li>
            </ul>
            <ul class="list-group" id="accuracy">
                <li class="list-group-item">Accuracy</li>
                <li class="list-group-item accuracy_value">{{ pc.getGameStat('accuracy') }}</li>
            </ul>
        </li>
    </ul>
    <button type="button" id="button" class="btn btn-primary btn-lg reset"
            ng-click="pc.clickedResetButton()">Reset
    </button>
</div>
<!-- Game Area ----------------------------------------------------------- -->
<div id="game-area" ng-controller="infoController as ic">

    <div ng-repeat='card in ic.cardArray' class="card">
        <div class="card_front">
            <img ng-src='{{ card.front }}' class="front" height="200px" width="150px">
        </div>
        <div class="card_back" ng-click="ic.cardClicked(card)" ng-hide="card.show">
            <img ng-src='{{ card.back }}' class="back" height="200px" width="150px">
        </div>
    </div>
</div>
</body>
<script>

    var app = angular.module("myApp", []);

    app.service('sharingIsCaring', function ($timeout) {

        var self = this;

        self.first_card = null;
        self.second_card = null;
        self.matched = [];
        self.matches = 0;
        self.attempts = 0;
        self.accuracy = 100;
        self.cardArray = [];
        self.array = [];
        self.card = null;

        self.imageArray = ['photos/56-f100-truck-DSC-0037.jpg', "photos/2015-Porsche-918-Spyder.jpg", "photos/ae86_levin_hatch_by_bramdc.jpg",
            "photos/e14592bd933e2191698240c13f74c791.jpg", "photos/lowfall_0Vn6_0.jpg", "photos/Mercedes-Benz 190 Cosworth (2).jpg",
            "photos/morris-mini-1275-01.jpg", "photos/porsche-911-carrera-2.7-rs-04.jpg", "photos/web13.jpg", 'photos/56-f100-truck-DSC-0037.jpg', "photos/2015-Porsche-918-Spyder.jpg", "photos/ae86_levin_hatch_by_bramdc.jpg",
            "photos/e14592bd933e2191698240c13f74c791.jpg", "photos/lowfall_0Vn6_0.jpg", "photos/Mercedes-Benz 190 Cosworth (2).jpg",
            "photos/morris-mini-1275-01.jpg", "photos/porsche-911-carrera-2.7-rs-04.jpg", "photos/web13.jpg"];

        var temporaryValue, randomIndex;

        self.shuffle = function (array) {
            var lastIndex = array.length - 1;
            while (0 !== lastIndex) {
                randomIndex = Math.floor(Math.random() * lastIndex);
                lastIndex -= 1;
                temporaryValue = array[lastIndex];
                array[lastIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }
            return array;
        };

        self.createCard = function () {
            console.log("createCard");
            for (i = 0; i < self.imageArray.length; i++) {
                var img = self.imageArray[i];
                var card = {
                    front: img,
                    back: 'photos/Design-Paper-Vine-pattern-Art-Nouveau.jpg',
                    show: false
                };
                self.cardArray.push(card);
            }
            self.cardArray = self.shuffle(self.cardArray);
            console.log("cardArray :", self.cardArray);
        };

        self.cardClicked = function (card) {
            if (self.first_card && self.second_card != null) {
                return;
            }
            console.log("card :", self.card);
//            console.log("card.show", this.card.show);
            if (self.first_card === null) {
                card.show = true;
                console.log("card.show :", card.show);
                self.first_card = card;
                self.attempts = self.attempts += 1;
//                self.accuracy = self.accuracy * 100;
                console.log("first card set", self.first_card);
            } else {
                card.show = true;
                self.second_card = card;
                console.log("second card set", self.second_card);
                if (self.first_card.front === self.second_card.front) {
                    var match = {
                        first_card: self.first_card.front,
                        second_card: self.second_card.front
                    };
                    console.log("match", match);
                    self.matched.push(match);
                    console.log("self.matched", self.matched);
                    self.matches = self.matches += 1;
                    self.attempts = self.attempts += 1;
//                    self.accuracy = self.accuracy * 100;
                    self.first_card = null;
                    self.second_card = null;
                } else {
                    $timeout(function () {
                        console.log("timeout");
                        console.log("card", card);
                        self.first_card.show = false;
                        self.second_card.show = false;
                        self.first_card = null;
                        self.second_card = null;
                        self.attempts = self.attempts += 1;
                        self.accuracy = (Math.floor(100 / self.attempts));
                    }, 2000);
                    console.log('no match');
                }
            }
        };

        self.resetStats = function () {
            console.log("resetStats function");
            self.first_card = null;
            self.second_card = null;
            self.matched = [];
            self.accuracy = 100;
            self.matches = 0;
            self.attempts = 0;
        };
    });

    app.controller("programController", function (sharingIsCaring) {
        this.accuracy = 0;
        this.matches = 0;
        this.attempts = 0;

        this.clickedResetButton = function () {
            sharingIsCaring.resetStats();
        };

        this.getGameStat = function (stat) {
            return sharingIsCaring[stat];
        };
    });

    app.controller("infoController", function ($timeout, sharingIsCaring) {
        console.log("shuffled");
        sharingIsCaring.createCard();
        this.cardArray = sharingIsCaring.cardArray;
        this.cardClicked = sharingIsCaring.cardClicked
    });


</script>
</html>



